const t=new class{constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.initialState=t,this.state=t.map(t=>[...t]),this.score=0,this.status="idle",this.dim=4,this.twoProbability=.9}moveLeft(){return this.move("left")}moveRight(){return this.move("right")}moveUp(){return this.move("up")}moveDown(){return this.move("down")}move(t){if("playing"!==this.status)return!1;let e="up"===t||"down"===t,s="up"===t||"left"===t?"left":"right",i=this.state.map(t=>[...t]),r=i;e&&(r=this.transpose(i));let a=this.swipeRows(s,r),o=this.combineRows(s,r);return o&&this.swipeRows(s,r),(!!a||!!o)&&(e?this.state=this.transpose(r):this.state=r,this.generate(),this.checkStatus(),!0)}swipeRows(t="left",e=this.state){let s=!1;for(let i of e){let e=i.filter(t=>t),r=Array(this.dim-e.length).fill(0),a="left"===t?e.concat(r):r.concat(e);if(i.toString()!==a.toString()){s=!0;for(let t=0;t<this.dim;t++)i[t]=a[t]}}return s}combineRows(t="left",e=this.state){let s=!1;for(let i of e)if("left"===t)for(let t=0;t<this.dim;t++)0!==i[t]&&i[t]===i[t+1]&&(1024===i[t]&&(this.status="win"),s=!0,i[t]*=2,i[t+1]=0,this.score+=i[t],t++);else for(let t=this.dim-1;t>=0;t--)0!==i[t]&&i[t]===i[t-1]&&(1024===i[t]&&(this.status="win"),s=!0,i[t]*=2,i[t-1]=0,this.score+=i[t],t--);return s}transpose(t){return t[0].map((e,s)=>t.map(t=>t[s]))}generate(){let t=[];for(let e=0;e<this.dim;e++)for(let s=0;s<this.dim;s++)0===this.state[e][s]&&t.push([e,s]);let[e,s]=t[Math.floor(Math.random()*t.length)];return this.state[e][s]=Math.random()<this.twoProbability?2:4,!0}checkStatus(){let t=this.state.some(t=>t.includes(0)),e=this.state.some((t,e)=>t.some((s,i)=>i<this.dim-1&&s===t[i+1]||e<this.dim-1&&s===this.state[e+1][i]));t||e||(this.status="lose")}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.status="playing",this.generate(),this.generate()}restart(){this.score=0,this.status="idle",this.state=this.initialState.map(t=>[...t])}},e=document.querySelector(".button"),s=document.querySelector(".game-score"),i=document.querySelector(".message-start"),r=document.querySelector(".message-win"),a=document.querySelector(".message-lose"),o=document.querySelector(".game-field").tBodies[0].rows,l=()=>{let e=t.getState();for(let t=0;t<4;t++)for(let s=0;s<4;s++){if(!e[t][s]){o[t].children[s].textContent="",o[t].children[s].className="",o[t].children[s].classList.add("field-cell");continue}o[t].children[s].textContent=e[t][s],o[t].children[s].className="",o[t].children[s].classList.add("field-cell",`field-cell--${e[t][s]}`)}};e.addEventListener("click",()=>{"idle"===t.getStatus()?(t.start(),i.classList.add("hidden"),e.classList.remove("start"),e.classList.add("restart"),e.textContent="Restart"):(a.classList.add("hidden"),r.classList.add("hidden"),t.restart(),t.start()),l()}),document.addEventListener("keydown",e=>{let i=!1,o=t.getStatus();if("playing"===o){switch(e.key){case"ArrowLeft":i=t.moveLeft();break;case"ArrowRight":i=t.moveRight();break;case"ArrowUp":i=t.moveUp();break;case"ArrowDown":i=t.moveDown()}i&&("win"===(o=t.getStatus())&&r.classList.remove("hidden"),"lose"===o&&a.classList.remove("hidden"),s.textContent=t.getScore(),l())}});
//# sourceMappingURL=index.2a71fb82.js.map
