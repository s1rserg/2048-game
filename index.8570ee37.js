!function(){function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function e(e,r){if(e){if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return t(e,r)}}function r(r){return function(e){if(Array.isArray(e))return t(e)}(r)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(r)||e(r)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var n=new/*#__PURE__*/(function(){var t;function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,n),this.initialState=t,this.state=t.map(function(t){return r(t)}),this.score=0,this.status="idle",this.dim=4,this.twoProbability=.9}return t=[{key:"moveLeft",value:function(){return this.move("left")}},{key:"moveRight",value:function(){return this.move("right")}},{key:"moveUp",value:function(){return this.move("up")}},{key:"moveDown",value:function(){return this.move("down")}},{key:"move",value:function(t){if("playing"!==this.status)return!1;var e="up"===t||"down"===t,n="up"===t||"left"===t?"left":"right",i=this.state.map(function(t){return r(t)}),a=i;e&&(a=this.transpose(i));var o=this.swipeRows(n,a),s=this.combineRows(n,a);return s&&this.swipeRows(n,a),(!!o||!!s)&&(e?this.state=this.transpose(a):this.state=a,this.generate(),this.checkStatus(),!0)}},{key:"swipeRows",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state,r=!1,n=!0,i=!1,a=void 0;try{for(var o,s=this,u=e[Symbol.iterator]();!(n=(o=u.next()).done);n=!0)!function(){var e=o.value,n=e.filter(function(t){return t}),i=s.dim-n.length,a=Array(i).fill(0),u="left"===t?n.concat(a):a.concat(n);if(e.toString()!==u.toString()){r=!0;for(var l=0;l<s.dim;l++)e[l]=u[l]}}()}catch(t){i=!0,a=t}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}return r}},{key:"combineRows",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"left",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state,r=!1,n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;if("left"===t)for(var l=0;l<this.dim;l++)0!==u[l]&&u[l]===u[l+1]&&(1024===u[l]&&(this.status="win"),r=!0,u[l]*=2,u[l+1]=0,this.score+=u[l],l++);else for(var c=this.dim-1;c>=0;c--)0!==u[c]&&u[c]===u[c-1]&&(1024===u[c]&&(this.status="win"),r=!0,u[c]*=2,u[c-1]=0,this.score+=u[c],c--)}}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}},{key:"transpose",value:function(t){return t[0].map(function(e,r){return t.map(function(t){return t[r]})})}},{key:"generate",value:function(){for(var t,r=[],n=0;n<this.dim;n++)for(var i=0;i<this.dim;i++)0===this.state[n][i]&&r.push([n,i]);var a=function(t){if(Array.isArray(t))return t}(t=r[Math.floor(Math.random()*r.length)])||function(t,e){var r,n,i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var a=[],o=!0,s=!1;try{for(i=i.call(t);!(o=(r=i.next()).done)&&(a.push(r.value),2!==a.length);o=!0);}catch(t){s=!0,n=t}finally{try{o||null==i.return||i.return()}finally{if(s)throw n}}return a}}(t,2)||e(t,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),o=a[0],s=a[1];return this.state[o][s]=Math.random()<this.twoProbability?2:4,!0}},{key:"checkStatus",value:function(){var t=this,e=this.state.some(function(t){return t.includes(0)}),r=this.state.some(function(e,r){return e.some(function(n,i){return i<t.dim-1&&n===e[i+1]||r<t.dim-1&&n===t.state[r+1][i]})});e||r||(this.status="lose")}},{key:"getScore",value:function(){return this.score}},{key:"getState",value:function(){return this.state}},{key:"getStatus",value:function(){return this.status}},{key:"start",value:function(){this.status="playing",this.generate(),this.generate()}},{key:"restart",value:function(){this.score=0,this.status="idle",this.state=this.initialState.map(function(t){return r(t)})}}],function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(n.prototype,t),n}()),i=document.querySelector(".button"),a=document.querySelector(".game-score"),o=document.querySelector(".message-start"),s=document.querySelector(".message-win"),u=document.querySelector(".message-lose"),l=document.querySelector(".game-field").tBodies[0].rows,c=function(){for(var t=n.getState(),e=0;e<4;e++)for(var r=0;r<4;r++){if(!t[e][r]){l[e].children[r].textContent="",l[e].children[r].className="",l[e].children[r].classList.add("field-cell");continue}l[e].children[r].textContent=t[e][r],l[e].children[r].className="",l[e].children[r].classList.add("field-cell","field-cell--".concat(t[e][r]))}};i.addEventListener("click",function(){"idle"===n.getStatus()?(n.start(),o.classList.add("hidden"),i.classList.remove("start"),i.classList.add("restart"),i.textContent="Restart"):(u.classList.add("hidden"),s.classList.add("hidden"),n.restart(),n.start()),c()}),document.addEventListener("keydown",function(t){var e=!1,r=n.getStatus();if("playing"===r){switch(t.key){case"ArrowLeft":e=n.moveLeft();break;case"ArrowRight":e=n.moveRight();break;case"ArrowUp":e=n.moveUp();break;case"ArrowDown":e=n.moveDown()}e&&("win"===(r=n.getStatus())&&s.classList.remove("hidden"),"lose"===r&&u.classList.remove("hidden"),a.textContent=n.getScore(),c())}})}();
//# sourceMappingURL=index.8570ee37.js.map
